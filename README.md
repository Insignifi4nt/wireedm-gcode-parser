# Wire EDM G‑Code Viewer

Interactive, modular viewer for Wire EDM G‑Code. Load `.gcode`, `.nc`, `.txt`, or `.iso`, visualize toolpaths (G0/G1/G2/G3), inspect bounds, add measurement points, edit G‑code in a drawer, and export normalized ISO programs.

## Quick Start

```bash
# Requirements: Node >= 16
npm install
npm run dev   # opens http://localhost:3000

# Build & preview
npm run build
npm run preview   # opens http://localhost:4173
```

- Main entry: `index.html` → `src/main.js`
- Legacy single‑file demo (no build needed): `documentation/wire-edm-gcode-viewer.html`

## Features

- Load and parse G‑code (G0/G1 linear, G2/G3 arcs with I/J)
- High‑DPI viewport: zoom, pan, fit‑to‑bounds; grid with major/minor lines
- Measurement points: click to add; list/manage in sidebar; export to CSV
- G‑Code Drawer: view/edit with line ↔ path highlight; insert clicked points as G0 moves
- ISO normalization: convert any G‑code/ISO text to Fanuc‑style ISO
  - Adds `%`, monotonically increasing N‑numbers, trailing `M02`, CRLF line endings
  - Strips `;` and `()` comments; preserves motion semantics

## Using the App

1. Load a file
   - Toolbar “Load G‑Code File” or drag‑and‑drop onto the button
   - Supported: `.gcode`, `.nc`, `.txt`, `.iso` (≤ 50 MB)
2. Navigate
   - Mouse wheel zoom; Shift+Left‑drag or Middle button to pan
   - Use “Fit to Screen” to center and scale content
3. Inspect
   - Sidebar shows live mouse XY, grid state, clicked points, path stats/bounds
   - Drawer: hover/click lines to highlight corresponding path segments
4. Export
   - “Normalize to ISO” for a normalized `.iso` from drawer text
   - “Export ISO” to save the current normalized program
   - “Export Points (CSV)” to save clicked measurement points

## Keyboard & Mouse Shortcuts

- Ctrl+= / Ctrl++: Zoom in
- Ctrl+-: Zoom out
- Ctrl+0: Reset zoom
- F: Fit to screen
- Arrow keys: Pan
- G: Toggle grid visibility
- Ctrl+C: Clear all points

## File Format Support

- Commands: G0/G1 linear, G2/G3 circular arcs with I/J center offsets
- Coordinates: X/Y (Z accepted by parser but not visualized)
- Comments: `;` inline and `()` block comments recognized
- Block numbers: Leading `N…` handled and regenerated by normalizer

## Architecture

- Core
  - `AppOrchestrator`: Bootstraps DOM, components, and wiring; manages lifecycle
  - `GCodeParser`: Parses text → `{ path, bounds, stats }`
  - `Viewport`: Zoom/pan transforms and fit‑to‑bounds utilities
  - Event system: `EventManager` with `src/core/events/*` (`EventBus`, `EventTypes`, `EventSchemas`, `EventValidator`, `EventHistory`, `DOMDelegation`, `EmitControls`)
- Components
  - `Canvas`: Grid + path rendering + highlights
  - `Toolbar`: File I/O, zoom/fit, drawer, normalization, exports
  - `Sidebar`: Coordinates, grid state, clicked points, path info
  - `GCodeDrawer`: Editor with line ↔ path highlight and point insertion
  - `StatusMessage`: Non‑blocking toasts for progress/feedback
  - Submodules: `components/toolbar/*`, `components/canvas/*`, `components/drawer/*`, `components/notifications/*`
- Utils
  - `IsoNormalizer`, `FileHandler`, `Constants`, `MathUtils`, `Sanitize`
  - Geometry: `utils/geometry/*` (transforms, arcs, bounds)

## Project Structure

```
WireEDM_app/
  index.html
  documentation/
    wire-edm-gcode-viewer.html       # legacy single-file demo (no build)
    initial_coordination/            # planning + coordination docs
    IssuesPictures/                  # screenshots and repro files
  src/
    main.js                          # app bootstrap via AppOrchestrator
    core/
      AppOrchestrator.js
      ComponentInitializer.js
      EventWiring.js
      GCodeParser.js
      Viewport.js
      events/                        # EventBus, EventTypes, Schemas, Validator, History, Delegation
      input/                         # TouchInteractions, TouchGestures
    components/
      Canvas.js, Toolbar.js, Sidebar.js, GCodeDrawer.js, StatusMessage.js
      toolbar/ (FileControls, ViewControls, ActionControls)
      canvas/  (CanvasGrid, PathHighlights, MarkerRenderer, CanvasRenderer)
      drawer/  (UndoRedoSystem, MultiSelectHandler, GCodeEditor, DrawerToolbar)
      notifications/ (ToastManager, MessageQueue, NotificationStyles)
    utils/
      IsoNormalizer.js, FileHandler.js, Constants.js, MathUtils.js, Sanitize.js
      geometry/ (CoordinateTransforms, ArcCalculations, BoundsCalculations)
    styles/
      main.css, components.css, theme.css
```

## Development

- Scripts
  - `npm run dev`: Start Vite dev server (port 3000)
  - `npm run build`: Production build to `dist/`
  - `npm run preview`: Preview built app (port 4173)
- Coding standards: see `src/standards/CodingStandards.md`
- Testing: no runner configured yet. If adding tests, prefer Vitest (unit) and/or Playwright (e2e). Place unit tests under `src/__tests__/` with `*.test.js` and add `"test": "vitest"` to scripts.

## Tips & Troubleshooting

- Hard refresh after major refactors (Ctrl+Shift+R) to clear cached assets
- If the app fails to start, check the console for any module path changes
- Large files (> 50 MB) are rejected by `FileHandler`
- On high‑DPI displays, verify browser zoom is 100% for accurate coordinates
- For mobile/device testing in WSL, see `documentation/WSL-Mobile-Access.md`

## Contributing

- Follow commit and PR guidelines in `AGENTS.md` (scoped, imperative commits; small, focused changes)
- Link relevant module PR notes under `documentation/RefactoringFiles/` when applicable

## Browser Support

Modern evergreen browsers. Targets ES2015+. IE11 is not supported.

## License

MIT
